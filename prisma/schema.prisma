generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id                String         @id @default(uuid())
  username          String         @unique
  email             String         @unique
  fullName          String
  badgeNumber       String?
  department        String?
  role              String
  passwordHash      String
  mfaEnabled        Boolean        @default(false)
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  accessLogs        AccessLog[]
  custodyEventsTo   CustodyEvent[] @relation("ToUser")
  custodyEventsFrom CustodyEvent[] @relation("FromUser")
  custodiedEvidence Evidence[]     @relation("CurrentCustodian")
  collectedEvidence Evidence[]     @relation("CollectedBy")
  createdBoxes      CrimeBox[]     @relation("BoxCreator")
}

model CrimeBox {
  id          String   @id @default(uuid())
  name        String
  caseId      String   @unique
  privateKey  String   @unique
  publicKey   String   @unique
  createdAt   DateTime @default(now())
  createdById String
  createdBy   User     @relation("BoxCreator", fields: [createdById], references: [id])
}

model Evidence {
  id                 String         @id @default(uuid())
  caseId             String
  type               String
  description        String
  collectionDate     DateTime
  location           String
  tags               String?
  fileHash           String?
  ipfsCid            String?
  status             String
  locked             Boolean        @default(false)
  officerNotes       String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  collectedById      String
  currentCustodianId String
  accessLogs         AccessLog[]
  custodyEvents      CustodyEvent[]
  currentCustodian   User           @relation("CurrentCustodian", fields: [currentCustodianId], references: [id])
  collectedBy        User           @relation("CollectedBy", fields: [collectedById], references: [id])
  files              EvidenceFile[]
}

model CustodyEvent {
  id         String   @id @default(uuid())
  eventType  String
  reason     String
  status     String
  signature  String?
  timestamp  DateTime @default(now())
  evidenceId String
  fromUserId String
  toUserId   String
  toUser     User     @relation("ToUser", fields: [toUserId], references: [id])
  fromUser   User     @relation("FromUser", fields: [fromUserId], references: [id])
  evidence   Evidence @relation(fields: [evidenceId], references: [id])
}

model AccessLog {
  id         String   @id @default(uuid())
  action     String
  ipAddress  String?
  userAgent  String?
  result     String
  timestamp  DateTime @default(now())
  evidenceId String
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  evidence   Evidence @relation(fields: [evidenceId], references: [id])
}

model EvidenceFile {
  id         String   @id @default(uuid())
  fileName   String
  fileSize   Int
  mimeType   String
  sha256Hash String
  ipfsCid    String?
  uploadedAt DateTime @default(now())
  evidenceId String
  evidence   Evidence @relation(fields: [evidenceId], references: [id])
}
